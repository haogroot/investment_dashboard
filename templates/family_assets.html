{% extends "base.html" %}

{% block content %}
<div class="row mb-4 fade-in">
    <div class="col-12">
        <div class="card bg-primary text-white text-center py-5 border-0 shadow-lg"
            style="background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);">
            <div class="card-body">
                <h2 class="display-6 fw-bold mb-3" data-i18n="family_total_assets">Family Total Assets</h2>
                <h1 class="display-3 fw-bold privacy-sensitive mb-2">
                    <span class="currency-symbol">NT$</span>
                    <span class="amount">{{ data.family_summary.total_couple_assets_twd | commas }}</span>
                </h1>
                <p class="lead opacity-75 mb-0" data-i18n="family_total_assets_desc">Consolidated view of liquid funds,
                    investments, real estate, and liabilities.</p>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4 fade-in" style="animation-delay: 0.1s;">
    <!-- Asset Breakdown -->
    <div class="col-lg-8">
        <div class="card h-100 shadow-sm">
            <div class="card-header bg-transparent border-bottom-0 pb-0 pt-4">
                <h5 class="mb-0 fw-bold"><i class="fas fa-layer-group me-2 text-primary"></i> <span
                        data-i18n="family_asset_breakdown">Asset Breakdown</span></h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th data-i18n="family_category">Category</th>
                                <th class="text-end" data-i18n="family_amount">Amount (TWD)</th>
                                <th class="text-end" style="width: 30%;" data-i18n="family_allocation">Allocation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Liquid Funds -->
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0 bg-info bg-opacity-10 text-info rounded p-2 me-3">
                                            <i class="fas fa-tint fa-fw"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0 fw-semibold" data-i18n="family_liquid_funds">Liquid Funds
                                            </h6>
                                            <small class="text-muted" data-i18n="family_liquid_desc">Cash, Deposits &
                                                FX</small>
                                        </div>
                                    </div>
                                </td>
                                <td class="text-end fw-medium privacy-sensitive">NT$ {{
                                    data.family_summary.total_liquid_funds_twd | commas }}</td>
                                <td class="text-end">
                                    {% set liq_pct = (data.family_summary.total_liquid_funds_twd /
                                    data.family_summary.total_couple_assets_twd * 100) if
                                    data.family_summary.total_couple_assets_twd > 0 else 0 %}
                                    <div class="d-flex align-items-center justify-content-end">
                                        <span class="me-2">{{ "%.1f"|format(liq_pct) }}%</span>
                                        <div class="progress flex-grow-1" style="height: 6px;">
                                            <div class="progress-bar bg-info" role="progressbar"
                                                style="width: {{ liq_pct }}%"></div>
                                        </div>
                                    </div>
                                </td>
                            </tr>

                            <!-- Investments -->
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div
                                            class="flex-shrink-0 bg-success bg-opacity-10 text-success rounded p-2 me-3">
                                            <i class="fas fa-chart-pie fa-fw"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0 fw-semibold" data-i18n="family_investments">Investment
                                                Assets</h6>
                                            <small class="text-muted" data-i18n="family_investments_desc">Stocks &
                                                ETFs</small>
                                        </div>
                                    </div>
                                </td>
                                <td class="text-end fw-medium privacy-sensitive text-success">NT$ {{
                                    data.family_summary.total_investments_twd | commas }}</td>
                                <td class="text-end">
                                    {% set inv_pct = (data.family_summary.total_investments_twd /
                                    data.family_summary.total_couple_assets_twd * 100) if
                                    data.family_summary.total_couple_assets_twd > 0 else 0 %}
                                    <div class="d-flex align-items-center justify-content-end">
                                        <span class="me-2">{{ "%.1f"|format(inv_pct) }}%</span>
                                        <div class="progress flex-grow-1" style="height: 6px;">
                                            <div class="progress-bar bg-success" role="progressbar"
                                                style="width: {{ inv_pct }}%"></div>
                                        </div>
                                    </div>
                                </td>
                            </tr>

                            <!-- Real Estate -->
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div
                                            class="flex-shrink-0 bg-warning bg-opacity-10 text-warning rounded p-2 me-3">
                                            <i class="fas fa-home fa-fw"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0 fw-semibold" data-i18n="family_real_estate">Real Estate</h6>
                                            <small class="text-muted" data-i18n="family_real_estate_desc">Property
                                                Value</small>
                                        </div>
                                    </div>
                                </td>
                                <td class="text-end fw-medium privacy-sensitive">NT$ {{
                                    data.family_summary.total_real_estate_twd | commas }}</td>
                                <td class="text-end">
                                    {% set re_pct = (data.family_summary.total_real_estate_twd /
                                    data.family_summary.total_couple_assets_twd * 100) if
                                    data.family_summary.total_couple_assets_twd > 0 else 0 %}
                                    <div class="d-flex align-items-center justify-content-end">
                                        <span class="me-2">{{ "%.1f"|format(re_pct) }}%</span>
                                        <div class="progress flex-grow-1" style="height: 6px;">
                                            <div class="progress-bar bg-warning" role="progressbar"
                                                style="width: {{ re_pct }}%"></div>
                                        </div>
                                    </div>
                                </td>
                            </tr>

                            <!-- Liabilities -->
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0 bg-danger bg-opacity-10 text-danger rounded p-2 me-3">
                                            <i class="fas fa-hand-holding-usd fa-fw"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0 fw-semibold" data-i18n="family_liabilities">Liabilities</h6>
                                            <small class="text-muted" data-i18n="family_liabilities_desc">Mortgages &
                                                Loans</small>
                                        </div>
                                    </div>
                                </td>
                                <td class="text-end fw-medium privacy-sensitive text-danger">NT$ {{
                                    data.family_summary.total_liabilities_twd | commas }}</td>
                                <td class="text-end">
                                    {% set liab_pct = ((data.family_summary.total_liabilities_twd|abs) /
                                    (data.family_summary.total_couple_assets_twd +
                                    (data.family_summary.total_liabilities_twd|abs)) * 100) if
                                    data.family_summary.total_couple_assets_twd > 0 else 0 %}
                                    <div class="d-flex align-items-center justify-content-end text-danger">
                                        <span class="me-2">-{{ "%.1f"|format(liab_pct) }}%</span>
                                        <div class="progress flex-grow-1" style="height: 6px;">
                                            <div class="progress-bar bg-danger" role="progressbar"
                                                style="width: {{ liab_pct }}%"></div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Liquid Details -->
    <div class="col-lg-4">
        <div class="card h-100 shadow-sm">
            <div class="card-header bg-transparent border-bottom-0 pb-0 pt-4">
                <h5 class="mb-0 fw-bold"><i class="fas fa-tint me-2 text-info"></i> <span
                        data-i18n="family_liquid_details">Liquid Details</span></h5>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item px-0 bg-transparent border-secondary-subtle">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted fw-bold" data-i18n="family_emerg_fund">Emergency Fund</span>
                            <span class="fw-bold privacy-sensitive h5 mb-0">{{ data.property.emergency_fund | commas
                                }}</span>
                        </div>
                        {% if data.property.details and data.property.details.emergency_fund %}
                        <div class="small ms-2 mt-2 border-start border-2 ps-2 border-info">
                            {% for item in data.property.details.emergency_fund %}
                            <div class="d-flex justify-content-between text-muted mb-1">
                                <span>{{ item.name }}</span>
                                <span class="privacy-sensitive">{{ item.amount | commas }}</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </li>
                    <li class="list-group-item px-0 bg-transparent border-secondary-subtle">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted fw-bold" data-i18n="family_demand_deposit">Demand Deposit</span>
                            <span class="fw-bold privacy-sensitive h5 mb-0">{{ data.property.demand_deposit | commas
                                }}</span>
                        </div>
                        {% if data.property.details and data.property.details.demand_deposit %}
                        <div class="small ms-2 mt-2 border-start border-2 ps-2 border-info">
                            {% for item in data.property.details.demand_deposit %}
                            <div class="d-flex justify-content-between text-muted mb-1">
                                <span>{{ item.name }}</span>
                                <span class="privacy-sensitive">{{ item.amount | commas }}</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </li>
                    <li class="list-group-item px-0 bg-transparent border-secondary-subtle">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted fw-bold" data-i18n="family_fx_cash">FX Cash</span>
                            <span class="fw-bold privacy-sensitive h5 mb-0">{{ data.property.fx_cash | commas }}</span>
                        </div>
                        {% if data.property.details and data.property.details.fx_cash %}
                        <div class="small ms-2 mt-2 border-start border-2 ps-2 border-info">
                            {% for item in data.property.details.fx_cash %}
                            <div class="d-flex justify-content-between text-muted mb-1">
                                <span>{{ item.name }}</span>
                                <span class="privacy-sensitive">{{ item.amount | commas }}</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </li>
                    <li class="list-group-item px-0 bg-transparent border-secondary-subtle border-bottom-0">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted fw-bold" data-i18n="family_fx_deposit">FX Deposit</span>
                            <span class="fw-bold privacy-sensitive h5 mb-0">{{ data.property.fx_deposit | commas
                                }}</span>
                        </div>
                        {% if data.property.details and data.property.details.fx_deposit %}
                        <div class="small ms-2 mt-2 border-start border-2 ps-2 border-info">
                            {% for item in data.property.details.fx_deposit %}
                            <div class="d-flex justify-content-between text-muted mb-1">
                                <span>{{ item.name }}</span>
                                <span class="privacy-sensitive">{{ item.amount | commas }}</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </li>
                </ul>

                <div class="mt-4 p-3 bg-dark-subtle rounded text-center border border-secondary-subtle">
                    <p class="text-muted mb-1 small" data-i18n="family_total_liquid">Total Liquid Funds</p>
                    <h4 class="mb-0 fw-bold text-info privacy-sensitive">{{ data.family_summary.total_liquid_funds_twd |
                        commas }}</h4>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}